{{ include("@ZikulaDizkusModule/Common/header.html.twig", {'parent':forum}) }}
{% if settings.ajax is defined and settings.ajax %}
    {{ pageAddAsset('javascript', zasset('@ZikulaDizkusModule:js/Zikula.Dizkus.Tools.js')) }}
    {{ pageAddAsset('javascript', zasset('@ZikulaDizkusModule:js/Zikula.Dizkus.User.ViewForum.js')) }}
    <input id="forum_id" type="hidden" value={{ forum.forum_id }}>
{% endif %}

{# ******************************************************
* FORUM NAVBAR
******************************************************* #}
{% if permissions.comment  %}
    <nav class="navbar navbar-default" role="navigation">
        <!-- Brand and toggle get grouped for better mobile display -->
        <div class="navbar-header">
            <button type="button" class="navbar-toggle" data-toggle="collapse" data-target="#navbar-forum-collapse">
                <span class="sr-only">{{ __('Toggle navigation') }}</span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
            </button>
            <a class="navbar-brand" href="#">{{ forum.name|escape('html') }}&nbsp;{{ __('forum') }}</a>
        </div>

        <!-- Collect the nav links, forms, and other content for toggling -->
        <div id="navbar-forum-collapse" class="collapse navbar-collapse">
            <ul class="nav navbar-nav navbar-right">

                {% if permissions.comment and not forum.isLocked() %}
                    <li><a class="fa fa-comment-o" title="{{ __("Start a new topic") }}" href="{{ path('zikuladizkusmodule_topic_newtopic', {'forum':forum.forum_id}) }}">&nbsp;{{ __("New topic") }}</a></li>
                    {% endif %}
                    {% if currentForumUser.loggedIn %}
                    <li>
                        {% set isForumSubscribed=currentForumUser.forumSubscribed(forum) %}
                        {% if isForumSubscribed %}
                            {% set url=path('zikuladizkusmodule_user_removeforumsubscription', {'forum':forum.forum_id}) %}
                            {% set msg= __("Unsubscribe from forum") %}                                                       
                        {% else %}
                            {% set url=path('zikuladizkusmodule_user_addforumsubscription', {'forum':forum.forum_id}) %}
                            {% set msg= __("Subscribe to forum") %}                           
                        {% endif %}
                        <a class="fa fa-envelope-o" id="forum-subscription" data-status="{% if isForumSubscribed %}1{% else %}0{% endif %}" href="{{ url }}" title="{{ msg }}">&nbsp;{{ msg }}</a>
                    </li>
                    {% if settings.favorites_enabled %}
                        <li>
                            {% set isForumFavorite=currentForumUser.forumFavorite(forum) %}
                            {% if isForumFavorite %}
                                {% set url=path('zikuladizkusmodule_user_removefavoriteforum', {'forum':forum.forum_id}) %}
                                {% set msg= __("Remove forum from favourites") %}
                            {% else %}
                                {% set url=path('zikuladizkusmodule_user_addfavoriteforum', {'forum':forum.forum_id}) %}
                                {% set msg= __("Add forum to favourites") %}
                            {% endif %}
                            <a class="fa fa-heart-o" id="forum-favourite" data-status="{% if isForumFavorite %}1{% else %}0{% endif %}" href="{{ url }}" title="{{ msg }}">&nbsp;{{ msg }}</a>
                        </li>
                    {% endif %} 
                {% endif %}

                {% if isModerator or permissions.moderate %}
                    <li><a class="fa fa-wrench" title="{{ __("Moderate") }}" href="{{ path('zikuladizkusmodule_forum_moderateforum', {'forum': forum.forum_id}) }}">&nbsp;{{ __("Moderate") }}</a></li>
                    {% endif %}
            </ul>
        </div><!-- /.navbar-collapse -->
    </nav>
{% endif %}

{# ******************************************************
* SUBFORUM DISPLAY
******************************************************* #}
{% if forum.children|length > 0 %}
    <div class="panel panel-default">
        <div class="panel-heading clearfix">
            <h2 class="dizkus-clean pull-left">
                <span class="fa-stack">
                    <i class="fa fa-comments fa-stack-2x"></i>
                    {% if forum.isLocked() %}<i class="fa fa-lock fa-stack-1x fa-overlay-lower-right"></i>{% endif %}
                </span>
                &nbsp;{{ forum.name|escape('html') }}&nbsp;{{ __('subforums') }}
            </h2>
        </div>
        {% if forum.description != '' %}
            <div class="panel-body">{{ forum.description|escape('html') }}</div>
        {% endif %}
        {{ include("@ZikulaDizkusModule/Forum/singleforumtable.html.twig" , {'parent': forum }) }}
        {% if topics is not defined or topics|length == 0 %}
            {{ include("@ZikulaDizkusModule/Forum/panelfooter.html.twig") }}
        {% endif %}
    </div>
{% endif %}


{# ******************************************************
* TOPICS TABLE
******************************************************* #}
{% if topics is defined %}
    {% if topics|length > 0 %}
        <div class="panel panel-info">
            <div class="panel-heading">
                <h2>{{ forum.name|escape('html') }}&nbsp;{{ __('topics') }}</h2>
            </div>
            {{ pager({rowcount:pager.numitems, limit:pager.itemsperpage, posvar:'start', route:'zikuladizkusmodule_forum_viewforum'}) }}       
            {{ include("@ZikulaDizkusModule/Forum/forumtopicstable.html.twig") }}
            {{ pager({rowcount:pager.numitems, limit:pager.itemsperpage, posvar:'start', route:'zikuladizkusmodule_forum_viewforum'}) }} 
            {{ include("@ZikulaDizkusModule/Forum/panelfooter.html.twig") }}
        </div>
    {% elseif not forum.isLocked() %}
        <div class="alert alert-info text-center">
            {{ __("There are no topics in this forum yet.") }}&nbsp;<a class="fa fa-comment-o btn btn-info btn-sm" title="{{ __("Start a new topic") }}" href="{{ path('zikuladizkusmodule_topic_newtopic', {'forum':forum.forum_id}) }}">&nbsp;{{ __("Start a new topic") }}</a>
        </div>
    {% endif %}
{% endif %}

<div id="dzk_displayhooks">
    {{ notifyDisplayHooks(eventName='dizkus.ui_hooks.forum.ui_view', id=forum.forum_id) }}
</div>
{{ include("@ZikulaDizkusModule/User/moderatedBy.html.twig", {'forum':forum, 'well': true}) }}

<script type="text/javascript">
    // <![CDATA[
    var subscribeForum = " {{ __('Subscribe to forum') }}";
    var unsubscribeForum = " {{ __('Unsubscribe from forum') }}";
    var favouriteForum = " {{ __('Add forum to favourites') }}";
    var unfavouriteForum = " {{ __('Remove forum from favourites') }}";
    // ]]>
</script>
{{ include("@ZikulaDizkusModule/Common/footer.html.twig") }}
