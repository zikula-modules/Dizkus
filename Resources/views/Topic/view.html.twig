{# CREATE ICON VARIABLES #}
{% set unsubscribe_icon %}<span class='fa-stack'><i class='fa fa-ban fa-stack-2x'></i><i class='fa fa-envelope-o fa-stack-1x'></i></span>{% endset %}
{% set subscribe_icon %}<span class='fa-stack'><i class='fa fa-envelope-o fa-stack-1x'></i></span>{% endset %}
{% set unsticky_icon %}<span class='fa-stack'><i class='fa fa-ban fa-stack-2x'></i><i class='fa fa-bullhorn fa-stack-1x'></i></span>{% endset %}
{% set sticky_icon %}<span class='fa-stack'><i class='fa fa-bullhorn fa-stack-1x'></i></span>{% endset %}
{# ------- #}

{% set templatetitle=topic.title|escape('html') %}
{{ include("@ZikulaDizkusModule/Common/header.html.twig", {'parent':topic.forum.forum_id}) }}
<input id="topic_id" name="topic" type="hidden" value="{{ topic.topic_id }}">
{% if settings.ajax %}
    {{ pageAddAsset('javascript', zasset('@ZikulaDizkusModule:js/Zikula.Dizkus.Tools.js')) }}
    {{ pageAddAsset('javascript', zasset('@ZikulaDizkusModule:js/Zikula.Dizkus.User.ViewTopic.js')) }}
{% endif %}

{% if settings.solved_enabled and topic.solved == -1 %}
    {% set topic_unsolved_style=' style="display:inline;"' %}
    {% set topic_solved_style=' style="display:none;"' %}    
{% elseif settings.solved_enabled and topic.solved == 0 %}
    {% set topic_unsolved_style=' style="display:none;"' %}
    {% set topic_solved_style=' style="display:inline;"' %}
{% else %}
    {% set topic_unsolved_style=' style="display:none;"' %}
    {% set topic_solved_style=' style="display:none;"' %}
{% endif %}

<h2>
    <span class="text-danger" id="topic_unsolved"{{ topic_unsolved_style }}>
        [<span class="fa fa-question">&nbsp;{{ __("Support request") }}</span>]
    </span>
    <span class="text-success" id="topic_solved"{{ topic_solved_style }}>
        [<span class="fa fa-check">&nbsp;{{ __("Solved") }}</span>]
    </span>
    <span id="edittopicsubjectbutton" title="">
        <span id="topic_title">{{ topic.title|escape('html')|notifyFilters('dizkus.filter_hooks.post.filter') }}</span><span id='edittopicicon' style='display:none;'>&nbsp;<i class="fa fa-pencil fa fa-red"></i></span>
    </span>
</h2>

{# add inline edit #}
{% if (settings.ajax and (isModerator or topic.userAllowedToEdit())) %}
{% set templatetitle=topic.title|escape('html') %}
{{ include("@ZikulaDizkusModule/Topic/editsubject.html.twig") }}
{% endif %}    
    
{# ******************************************************
* TOPIC NAVBAR
******************************************************* #}

<nav class="navbar navbar-topic navbar-default" role="navigation">
    <!-- Brand and toggle get grouped for better mobile display -->
    <div class="navbar-header">
        <button type="button" class="navbar-toggle" data-toggle="collapse" data-target="#navbar-topic-collapse">
            <span class="sr-only">{{ __('Toggle navigation') }}</span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
        </button>
        <a class="navbar-brand fa fa-comments" style='font-size:3em;color:mediumseagreen' href="#"></a>
    </div>

    <!-- Collect the nav links, forms, and other content for toggling -->
    <div id="navbar-topic-collapse" class="collapse navbar-collapse">
        <ul class="nav navbar-nav navbar-left">
            {% if previousTopic is not empty and topic.topic_id != previousTopic %}{% set disabled='' %}{% else %}{% set disabled=' disabled' %}{% endif %}
            <li><a class="tooltips fa fa-chevron-left{{ disabled }}" title="{{ __("Previous topic") }}" href="{{ path('zikuladizkusmodule_topic_viewtopic', {'topic':previousTopic}) }}"></a></li>
            {% if nextTopic is not empty and topic.topic_id != nextTopic %}{% set disabled='' %}{% else %}{% set disabled=' disabled' %}{% endif %}
            <li><a class="tooltips fa fa-chevron-right{{ disabled }}" title="{{ __("Next topic") }}" href="{{ path('zikuladizkusmodule_topic_viewtopic', {'topic': nextTopic}) }}"></a></li>

            {% if permissions.comment %}
            <li><a class="fa fa-comment-o tooltips" title="{{ __("Create a new topic") }}" href="{{ path('zikuladizkusmodule_topic_newtopic', {'forum':topic.forum.forum_id}) }}">&nbsp;{{ __("New topic") }}</a></li>
            {% endif %}

            {% if userLoggedIn() %}
            <li><a class="tooltips" title="{{ __("Send the posts within this topic as an e-mail message to someone") }}" href="{{ path('zikuladizkusmodule_topic_emailtopic', {'topic': topic.topic_id}) }}">
               <span class="fa-stack">
                   <i class="fa fa-envelope-o fa-stack-1x"></i>
                   <i class="fa fa-share fa-stack-1x fa-overlay-upper-left" style='color:lightblue;'></i>
               </span>
            </a></li>
            {% endif %}
            {#    @todo        <li>{printtopic_button topic_id=$topic.topic_id forum=$topic.forum}</li>#}
            {% if userLoggedIn() %}
            <li>
                {% if isSubscribed %} 
                    {% set url=path('zikuladizkusmodule_topic_changetopicstatus', {'action':'unsubscribe', 'topic':topic.topic_id}) %}
                    {% set msg=__("Unsubscribe from topic") %}                   
                {% else %}
                    {% set url=path('zikuladizkusmodule_topic_changetopicstatus', {'action':'subscribe', 'topic':topic.topic_id}) %}
                    {% set msg=__("Subscribe to topic") %}                     
                 {% endif %}
                <a id="toggletopicsubscription" class="tooltips" data-action="{% if isSubscribed %}unsubscribe{% else %}subscribe{% endif %}" href="{{ url }}" title="{{ msg }}">
                    {% if isSubscribed %}{{ unsubscribe_icon }}{% else %}{{ subscribe_icon }}{% endif %}
                </a>
            </li>
            {% endif %}
        </ul>
        <ul class="nav navbar-nav navbar-right">
            {% if isModerator %}
            <li>
                {% if topic.status == 0 %}
                    {% set url=path('zikuladizkusmodule_topic_changetopicstatus', {'action':'lock', 'topic':topic.topic_id}) %}
                    {% set msg=__("Lock topic") %}
                    {% set iconclass="fa fa-lock" %}
                {% else %}
                    {% set url=path('zikuladizkusmodule_topic_changetopicstatus', {'action':'unlock', 'topic':topic.topic_id }) %}
                    {% set msg=__("Unlock topic") %}
                    {% set iconclass="fa fa-unlock" %}
                {% endif %}
                <a id="toggletopiclock" class="{{ iconclass }} tooltips" title="{{ msg }}" data-action="{% if topic.status %}unlock{% else %}lock{% endif %}" href="{{ url }}"></a>
            </li>
            <li>
                {% if topic.sticky == 0 %}
                    {% set url=path('zikuladizkusmodule_topic_changetopicstatus', {'action':'sticky', 'topic':topic.topic_id}) %}
                    {% set msg=__("Give this topic 'sticky' status") %}                    
                {% else %}
                    {% set url=path('zikuladizkusmodule_topic_changetopicstatus', {'action':'unsticky', 'topic':topic.topic_id}) %}
                    {% set msg=__("Remove 'sticky") %}                   
                {% endif %}
                <a id="toggletopicsticky" class="tooltips" title="{{ msg }}" data-action="{% if topic.sticky %}unsticky{% else %}sticky{% endif %}" href="{{ url }}">
                    {% if topic.sticky == 0 %}{{ sticky_icon }}{% else %}{{ unsticky_icon }}{% endif %}
                </a>
            </li>
            <li><a class="fa fa-arrow-right tooltips" title="{{ __("Move or join topic") }}" href="{{ path('zikuladizkusmodule_topic_movetopic', {'topic':topic.topic_id}) }}"></a></li>
            <li><a class="fa fa-times tooltips" title="{{ __("Delete topic") }}" href="{{ path('zikuladizkusmodule_topic_deletetopic', {'topic':topic.topic_id}) }}"></a></li>
            {% endif %}
            <li><a class="tooltips" title="{{ __("To bottom of page") }}" href="#bottom"><i class="fa fa-chevron-circle-down"></i></a></li>
        </ul>
    </div><!-- /.navbar-collapse -->
</nav>

{# ******************************************************
* TOPIC LIST
******************************************************* #}

{{ pager({rowcount:pager.numitems, limit:pager.itemsperpage|default(15), posvar:'start', route:'zikuladizkusmodule_topic_viewtopic'}) }} 
<div id="dzk_postinglist">
    <ul class="post_list">
        {% for num, post in posts %}
            <li class="post post_{{ post.post_id }}">
                {{ include("@ZikulaDizkusModule/Post/single.html.twig") }}
            </li>
        {% endfor %}
        
        {#  Not needed
        <li id="quickreplyposting" class="hidden">&nbsp;</li>
        <li id="quickreplypreview" class="hidden">&nbsp;</li>#}
    </ul>
</div>
{{ pager({rowcount:pager.numitems, limit:pager.itemsperpage|default(15), posvar:'start', route:'zikuladizkusmodule_topic_viewtopic'}) }} 

{# ******************************************************
* QUICK REPLY FORM
******************************************************* #}
{% if permissions.comment == true %}
    <div id="quickreply">    
        {{ render(controller(
            'ZikulaDizkusModule:Topic:replyTopic',
            { 'topic': topic.topic_id, 'template': 'quick.reply'}
        )) }}
    </div>
{% endif %}

{{ include("@ZikulaDizkusModule/User/moderatedBy.html.twig", {'forum':topic.forum, 'well': true}) }}

{{ include("@ZikulaDizkusModule/Topic/translations.html.twig") }}

<a id="bottom" accesskey="b"></a>
{{ include("@ZikulaDizkusModule/Common/footer.html.twig") }}
